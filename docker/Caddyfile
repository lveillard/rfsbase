# Production Caddyfile for RFSbase
# Automatically provisions SSL certificates via Let's Encrypt
# Now with consolidated architecture - Next.js handles everything

{
    email {$ADMIN_EMAIL:admin@rfsbase.com}
}

# Main domain - serves the Next.js app (includes API routes and Server Actions)
{$DOMAIN:rfsbase.com} {
    reverse_proxy frontend:3000

    # Security headers
    header {
        X-Frame-Options "DENY"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        Permissions-Policy "camera=(), microphone=(), geolocation=()"
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
    }

    # Gzip compression
    encode gzip

    # Logging
    log {
        output file /data/access.log
        format json
    }
}

# (Backend API removed - now handled by Next.js Server Actions)
